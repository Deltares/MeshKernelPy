

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mesh2d refinement based on gridded samples &mdash; MeshKernelPy 2.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=20623aea"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Mesh2d refinement based on Gebco gridded samples with variable depth precision" href="06_mesh2d_refinement_gridded_samples_gebco.html" />
    <link rel="prev" title="Curvilineargrid Basics" href="04_curvilineargrid_basics.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            MeshKernelPy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01_mesh2d_basics.html">Mesh2d Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_mesh1d_basics.html">Mesh1d basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_tri_mesh2d_pol.html">Simple triangular mesh in a given geometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="04_curvilineargrid_basics.html">Curvilineargrid Basics</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Mesh2d refinement based on gridded samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="06_mesh2d_refinement_gridded_samples_gebco.html">Mesh2d refinement based on Gebco gridded samples with variable depth precision</a></li>
<li class="toctree-l2"><a class="reference internal" href="06_mesh2d_refinement_gridded_samples_gebco.html#generating-a-mesh-of-defined-extension">1. Generating a mesh of defined extension</a></li>
<li class="toctree-l2"><a class="reference internal" href="06_mesh2d_refinement_gridded_samples_gebco.html#saving-the-generated-mesh-to-ugrid-file">2. Saving the generated mesh to UGrid file</a></li>
<li class="toctree-l2"><a class="reference internal" href="06_mesh2d_refinement_gridded_samples_gebco.html#reading-bathymetric-data-form-a-large-netdfc-file">3. Reading bathymetric data form a large NetDFC file</a></li>
<li class="toctree-l2"><a class="reference internal" href="06_mesh2d_refinement_gridded_samples_gebco.html#performing-mesh-refinement-based-on-gridded-data-depths-as-np-float32-or-np-int16">4. Performing mesh refinement based on gridded data, depths as np.float32 or np.int16</a></li>
<li class="toctree-l2"><a class="reference internal" href="07_curvilineargrid_with_defined_extension.html">Curvilinear grid generation with defined extension</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/modules.html">MeshKernelPy</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MeshKernelPy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Examples</a></li>
      <li class="breadcrumb-item active">Mesh2d refinement based on gridded samples</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/05_mesh2d_refinement_gridded_samples.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mesh2d-refinement-based-on-gridded-samples">
<h1>Mesh2d refinement based on gridded samples<a class="headerlink" href="#mesh2d-refinement-based-on-gridded-samples" title="Link to this heading">ÔÉÅ</a></h1>
<p>This is a brief introduction to the process of mesh refinement using gridded samples. When refining the mesh using gridded samples, bilinear interpolation is used to calculate the depth values at the mesh nodes.</p>
<p>At the very beginning, the necessary libraries have to be imported.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">meshkernel</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">GeometryList</span><span class="p">,</span>
    <span class="n">GriddedSamples</span><span class="p">,</span>
    <span class="n">MakeGridParameters</span><span class="p">,</span>
    <span class="n">MeshKernel</span><span class="p">,</span>
    <span class="n">MeshRefinementParameters</span><span class="p">,</span>
    <span class="n">RefinementType</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">meshkernel</span></code> provides a set of convenience methods for creating common meshes.</p>
<p>We use the <code class="docutils literal notranslate"><span class="pre">curvilinear_compute_rectangular_grid</span></code> method to create a simple curvilinear grid.
You can look at the documentation in order to find all its parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mk</span> <span class="o">=</span> <span class="n">MeshKernel</span><span class="p">()</span>

<span class="n">make_grid_parameters</span> <span class="o">=</span> <span class="n">MakeGridParameters</span><span class="p">()</span>
<span class="n">make_grid_parameters</span><span class="o">.</span><span class="n">num_columns</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">make_grid_parameters</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">make_grid_parameters</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">make_grid_parameters</span><span class="o">.</span><span class="n">origin_x</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">make_grid_parameters</span><span class="o">.</span><span class="n">origin_y</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">make_grid_parameters</span><span class="o">.</span><span class="n">block_size_x</span> <span class="o">=</span> <span class="mf">100.0</span>
<span class="n">make_grid_parameters</span><span class="o">.</span><span class="n">block_size_y</span> <span class="o">=</span> <span class="mf">100.0</span>

<span class="n">mk</span><span class="o">.</span><span class="n">curvilinear_compute_rectangular_grid</span><span class="p">(</span><span class="n">make_grid_parameters</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We convert the curvilinear grid to an unstructured mesh and get the resulting mesh2d</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mk</span><span class="o">.</span><span class="n">curvilinear_convert_to_mesh2d</span><span class="p">()</span>
<span class="n">mesh2d_input</span> <span class="o">=</span> <span class="n">mk</span><span class="o">.</span><span class="n">mesh2d_get</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The generated mesh can be visualized as follow</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">mesh2d_input</span><span class="o">.</span><span class="n">plot_edges</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d751ee36391ccc4785ec5f7b2ca2274ee8bf52dc05a54371437e18cf717dbda2.png" src="../_images/d751ee36391ccc4785ec5f7b2ca2274ee8bf52dc05a54371437e18cf717dbda2.png" />
</div>
</div>
<p>Now we define the gridded samples with uniform spacing</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gridded_samples</span> <span class="o">=</span> <span class="n">GriddedSamples</span><span class="p">(</span>
    <span class="n">num_x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">num_y</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">x_origin</span><span class="o">=-</span><span class="mf">50.0</span><span class="p">,</span>
    <span class="n">y_origin</span><span class="o">=-</span><span class="mf">50.0</span><span class="p">,</span>
    <span class="n">cell_size</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
    <span class="n">values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.05</span><span class="p">]</span> <span class="o">*</span> <span class="mi">42</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And the parameters for the mesh refinement algorithm</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">refinement_params</span> <span class="o">=</span> <span class="n">MeshRefinementParameters</span><span class="p">(</span>
    <span class="n">refine_intersected</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">use_mass_center_when_refining</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">min_edge_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
    <span class="n">refinement_type</span><span class="o">=</span><span class="n">RefinementType</span><span class="o">.</span><span class="n">WAVE_COURANT</span><span class="p">,</span>
    <span class="n">connect_hanging_nodes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">account_for_samples_outside_face</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">max_refinement_iterations</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Refinement can now be performed</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mk</span><span class="o">.</span><span class="n">mesh2d_refine_based_on_gridded_samples</span><span class="p">(</span><span class="n">gridded_samples</span><span class="p">,</span> <span class="n">refinement_params</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can now visualize the refined grid</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mesh2d_output</span> <span class="o">=</span> <span class="n">mk</span><span class="o">.</span><span class="n">mesh2d_get</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">mesh2d_output</span><span class="o">.</span><span class="n">plot_edges</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9ce92fc6ba7dc6e5380114df8d682388386f2b34e6c0175e892e6bc98c16bd56.png" src="../_images/9ce92fc6ba7dc6e5380114df8d682388386f2b34e6c0175e892e6bc98c16bd56.png" />
</div>
</div>
<p>If gridding is not uniform, we can create the gridded samples differently, bmitting some of the GriddedSamples parameters.
First regenerate the starting mesh</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mk</span><span class="o">.</span><span class="n">curvilinear_compute_rectangular_grid</span><span class="p">(</span><span class="n">make_grid_parameters</span><span class="p">)</span>
<span class="n">mk</span><span class="o">.</span><span class="n">curvilinear_convert_to_mesh2d</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">mesh2d_input</span><span class="o">.</span><span class="n">plot_edges</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d751ee36391ccc4785ec5f7b2ca2274ee8bf52dc05a54371437e18cf717dbda2.png" src="../_images/d751ee36391ccc4785ec5f7b2ca2274ee8bf52dc05a54371437e18cf717dbda2.png" />
</div>
</div>
<p>When refining the mesh with gridded samples that have non-uniform x or y spacing, the non-uniform spacing can be specified by using the x_coordinates and y_coordinates parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gridded_samples</span> <span class="o">=</span> <span class="n">GriddedSamples</span><span class="p">(</span>
    <span class="n">x_coordinates</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">50.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">150.0</span><span class="p">,</span> <span class="mf">250.0</span><span class="p">,</span> <span class="mf">350.0</span><span class="p">,</span> <span class="mf">450.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">),</span>
    <span class="n">y_coordinates</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="o">-</span><span class="mf">50.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">150.0</span><span class="p">,</span> <span class="mf">250.0</span><span class="p">,</span> <span class="mf">350.0</span><span class="p">,</span> <span class="mf">450.0</span><span class="p">,</span> <span class="mf">550.0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span>
    <span class="p">),</span>
    <span class="n">values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.05</span><span class="p">]</span> <span class="o">*</span> <span class="mi">42</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mk</span><span class="o">.</span><span class="n">mesh2d_refine_based_on_gridded_samples</span><span class="p">(</span><span class="n">gridded_samples</span><span class="p">,</span> <span class="n">refinement_params</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mesh2d_output</span> <span class="o">=</span> <span class="n">mk</span><span class="o">.</span><span class="n">mesh2d_get</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">mesh2d_output</span><span class="o">.</span><span class="n">plot_edges</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/db7cbda227901d81b5776204308cf5adc7bdd1800ea4762552f8e066705bda8e.png" src="../_images/db7cbda227901d81b5776204308cf5adc7bdd1800ea4762552f8e066705bda8e.png" />
</div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="04_curvilineargrid_basics.html" class="btn btn-neutral float-left" title="Curvilineargrid Basics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="06_mesh2d_refinement_gridded_samples_gebco.html" class="btn btn-neutral float-right" title="Mesh2d refinement based on Gebco gridded samples with variable depth precision" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Deltares.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>